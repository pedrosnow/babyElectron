<!DOCTYPE html style="width: 100%; height: 100% !important">
<html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' blob:; style-src 'self' 'unsafe-inline'; connect-src 'self' http://localhost http://localhost:5000; font-src 'self' data:; media-src 'self' http://localhost blob:;">

  <link rel="stylesheet" href="./public/css/style.css">
  <link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="./node_modules/sweetalert2/dist/sweetalert2.min.css">
  <link rel="stylesheet" href="./public/fontawesome/css/all.min.css">

  <script src="./node_modules/video.js/dist/video.js"></script>
  <link rel="stylesheet" href="./node_modules/video.js/dist/video-js.css">

  <script src="./public/js/jquery.js"></script>
  
  <title>Stream Bebe</title>
</head>

<body>

<!-- <main>
    <div class="container-logo-titulo">
      <div class="logo">
        <img src="./public/img/incone.svg">
      </div>
      <div class="titulo">Meu bebê</div>
    </div>
    <div class="container-formulario">
      <div class="titulo">Live</div>
      <div class="descricao">
        Para iniciar serar nescessario o <strong>codigo do paciente</strong> e um <strong>numero de whatsapp</strong> para enviar o link de acesso para o
        paciente
      </div>
      <div id="form">
        <div class="row">
          <div class="col">
            <label>Cod. Paciente</label>
            <input type="text" class="form-control" oninput="index.checkedNumber(this)" id="numero-paciente"
              placeholder="Digite o codigo do paciente" autofocus>
          </div>
        </div>
      </div>
      <button onclick="index.proximo(this)" id="btn-voltar" class="btn"><li class="fas fa-chevron-circle-left"></li></button>
      <button onclick="index.proximo(this)" id="btn-start" class="btn">Proximo</button>
      <a href="#" onclick="index.configuracao()">Configurações</a>
    </div>
    
  </main> -->

  <main class="container-stream">
    <div class="container-video">
    
    <div class="loading-video-stream">
        <div class="card" id="cardAviso">
            <div class="titulo">Live Online <div class="circle"></div> </div>
            <div class="descricao">Carregando a pre visualização</div>
        </div>
    </div>

    </div>
    <div class="container_options-button">
        
        <div class="container-send-number">
          <div id="modal-aviso-sucesso">
            <li class="incone fas fa-check-circle"></li>
            <div class="container-status">
              <div class="titulo">Sucesso</div>
              <div class="descricao">O acesso foi enviado para o <br> (86) 9 995747604</div>
            </div>
          </div>
            <div class="row">
            <div class="col">
                <label class="text-light">Enviando o Acesso</label>
                <input type="text" class="form-control" value="(86) 9 95747604">
            </div>
            </div>
            <div class="row">
            <div class="col">
                <button class="btn" id="enviar">00:40</button>
            </div>
            </div>
        </div>

        <button class="container-painel btn" id="encerrar">
        <div>E</div>
        <div>N</div>
        <div>C</div>
        <div>E</div>
        <div>R</div>
        <div>R</div>
        <div>A</div>
        <div>R</div>
        </button>
    </div>
</main>

<script>

setTimeout(()=>{

    $(".container-video").html('<video id="videostram" class="video-js vjs-default-skin" controls autoplay data-setup="{}"></video>');
    
    const player = videojs('videostram');
    let retryCount = 0;
    const maxRetries = 4; // Número máximo de tentativas

    function loadVideo() {
        player.src({
            src: 'http://localhost/hls/${this.data.chave}/index.m3u8',
            type: 'application/x-mpegURL'
        });
        player.load();
        player.play();
    }

    player.ready(function () {
        this.controlBar.addChild('CurrentTimeDisplay');
        this.controlBar.addChild('TimeDivider');
        this.controlBar.addChild('DurationDisplay');
        this.controlBar.addChild('ProgressControl');
        this.controlBar.addChild('PlaybackRateMenuButton');

        loadVideo();
    });

    player.on('error', function (event) {
        const error = player.error();

        if (error.code === 2) {
            // Verifica se ainda pode tentar novamente
            if (retryCount < maxRetries) {
                retryCount++;
                // Tenta novamente após um breve intervalo (por exemplo, 5 segundos)
                setTimeout(function () {
                    loadVideo();
                }, 2000); // 5 segundos
            } else {
                // Excedeu o número máximo de tentativas, faça o que desejar aqui
                console.log('Excedeu o número máximo de tentativas');
            }
        }
    });
    
},20000)

</script>

  <script src="./public/jQuery-Mask-Plugin-master/dist/jquery.mask.min.js"></script>
  <script src="./public/js/index.js"></script>
  <script src="./node_modules/sweetalert2/dist/sweetalert2.all.min.js"></script>
</body>

</html>